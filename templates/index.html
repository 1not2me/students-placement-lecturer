<!doctype html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8">
    <title>××¢×¨×›×ª ×©×™×‘×•×¥ ×¡×˜×•×“× ×˜×™× â€“ ×”×ª×××” ×—×›××”</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="page-wrap">

    <!-- ×›×•×ª×¨×ª ×¨××©×™×ª -->
    <h1>××¢×¨×›×ª ×©×™×‘×•×¥ ×¡×˜×•×“× ×˜×™× â€“ ×”×ª×××” ×—×›××”</h1>
    <p class="subtitle">
        ×›××Ÿ ××©×‘×¦×™× ×¡×˜×•×“× ×˜×™× ×œ××§×•××•×ª ×”×ª××—×•×ª ×‘×§×œ×•×ª, ×¢×œ ×‘×¡×™×¡ ×ª×—×•× ×”×ª××—×•×ª, ×¢×™×¨ ××’×•×¨×™× ×•×‘×§×©×•×ª ××™×•×—×“×•×ª â€“
        ×•×‘×œ×—×™×¦×ª ×›×¤×ª×•×¨ ××•×¨×™×“×™× ×§×•×‘×¦×™ XLSX ××¡×•×“×¨×™× ×œ××¨×¦×™×.
    </p>

    <!-- ×˜×•×¤×¡ ×”×¢×œ××” -->
    <section class="card">
        <h2>â¬†ï¸ ×”×¢×œ××ª ×§×‘×¦×™×</h2>
        <p>×™×© ×œ×”×¢×œ×•×ª ×§×‘×¦×™ ×¡×˜×•×“× ×˜×™× ×•××ª×¨×™ ×”×ª××—×•×ª (Excel ××• CSV) ×‘×¤×•×¨××˜ ×©× ×•×— ×œ×›×.</p>
        <form class="upload-form" method="post" enctype="multipart/form-data">
            <div class="field">
                <label for="students_file">ğŸ“„ ×§×•×‘×¥ ×¡×˜×•×“× ×˜×™×</label>
                <input type="file" id="students_file" name="students_file" required>
            </div>
            <div class="field">
                <label for="sites_file">ğŸ¥ ×§×•×‘×¥ ××ª×¨×™ ×”×ª××—×•×ª</label>
                <input type="file" id="sites_file" name="sites_file" required>
            </div>
            <div class="btn-wrap">
                <button type="submit" class="primary-btn">×‘×™×¦×•×¢ ×©×™×‘×•×¥ ×—×›×</button>
            </div>
        </form>

        {% if error %}
        <div class="alert error">
            {{ error }}
        </div>
        {% endif %}
    </section>

    {% if results %}
    <!-- ×ª×•×¦××•×ª ×©×™×‘×•×¥ -->
    <section class="card">
        <h2>ğŸ“‹ ×ª×•×¦××•×ª ×”×©×™×‘×•×¥</h2>
        <div class="btn-row">
            <a href="{{ url_for('download_results') }}" class="primary-btn small">â¬‡ï¸ ×”×•×¨×“×ª ×˜×‘×œ×ª ×©×™×‘×•×¥</a>
            <a href="{{ url_for('download_summary') }}" class="primary-btn ghost small">â¬‡ï¸ ×”×•×¨×“×ª ×˜×‘×œ×ª ×¡×™×›×•×</a>
        </div>
        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th>××—×•×– ×”×ª×××”</th>
                    <th>×©× ×”×¡×˜×•×“× ×˜/×™×ª</th>
                    <th>×ª×¢×•×“×ª ×–×”×•×ª</th>
                    <th>×ª×—×•× ×”×ª××—×•×ª</th>
                    <th>×¢×™×¨ ×”××•×¡×“</th>
                    <th>×©× ××§×•× ×”×”×ª××—×•×ª</th>
                    <th>×©× ×”××“×¨×™×š/×”</th>
                </tr>
                </thead>
                <tbody>
                {% for row in results %}
                    <tr>
                        <td class="score">{{ row["××—×•×– ×”×ª×××”"] }}%</td>
                        <td>{{ row["×©× ×”×¡×˜×•×“× ×˜/×™×ª"] }}</td>
                        <td>{{ row["×ª×¢×•×“×ª ×–×”×•×ª"] }}</td>
                        <td>{{ row["×ª×—×•× ×”×ª××—×•×ª"] }}</td>
                        <td>{{ row["×¢×™×¨ ×”××•×¡×“"] }}</td>
                        <td>{{ row["×©× ××§×•× ×”×”×ª××—×•×ª"] }}</td>
                        <td>{{ row["×©× ×”××“×¨×™×š/×”"] }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}

    {% if explanations %}
    <!-- ×”×¡×‘×¨ ×¦×™×•×Ÿ ×œ×“×•×’××” ×¢× × ×™×•×•×˜ ×‘×™×Ÿ ×›×œ ×”×¡×˜×•×“× ×˜×™× -->
    <section class="card" id="score-explain-card">
        <h2>ğŸ§© ×”×¡×‘×¨ ×¦×™×•×Ÿ ×œ×“×•×’××”</h2>
        <p id="score-summary">
            ×¡×˜×•×“× ×˜/×™×ª:
            <strong id="exp-student">{{ explanations[0].student }}</strong>,
            ××§×•× ×”×ª××—×•×ª:
            <strong id="exp-site">{{ explanations[0].site }}</strong>,
            ×¦×™×•×Ÿ ×¡×•×¤×™:
            <strong id="exp-score">{{ explanations[0].score }}%</strong>
            <span class="exp-counter">
                (<span id="exp-index">1</span> / {{ explanations|length }})
            </span>
        </p>

        <div class="table-wrap small">
            <table id="exp-table">
                <thead>
                <tr>
                    <th>××¨×›×™×‘</th>
                    <th>×ª×¨×•××” ×œ×¦×™×•×Ÿ</th>
                </tr>
                </thead>
                <tbody>
                {% for k, v in explanations[0].parts.items() %}
                    <tr>
                        <td>{{ k }}</td>
                        <td>{{ v }}</td>
                    </tr>
                {% endfor %}
                    <tr>
                        <td><strong>×¡×”×´×›</strong></td>
                        <td><strong id="exp-total">{{ explanations[0].score }}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="exp-nav">
            <button type="button" class="secondary-btn" id="exp-prev">â—€ ×”×§×•×“×</button>
            <button type="button" class="secondary-btn" id="exp-next">×”×‘× â–¶</button>
        </div>
    </section>

    <script>
        const explanations = {{ explanations|tojson }};
        let currentIndex = 0;

        function renderExplain() {
            const exp = explanations[currentIndex];

            document.getElementById('exp-student').textContent = exp.student;
            document.getElementById('exp-site').textContent = exp.site;
            document.getElementById('exp-score').textContent = exp.score + '%';
            document.getElementById('exp-index').textContent = (currentIndex + 1).toString();

            const tbody = document.querySelector('#exp-table tbody');
            tbody.innerHTML = '';

            for (const [k, v] of Object.entries(exp.parts)) {
                const tr = document.createElement('tr');
                const td1 = document.createElement('td');
                const td2 = document.createElement('td');
                td1.textContent = k;
                td2.textContent = v;
                tr.appendChild(td1);
                tr.appendChild(td2);
                tbody.appendChild(tr);
            }

            const trTotal = document.createElement('tr');
            const tdT1 = document.createElement('td');
            const tdT2 = document.createElement('td');
            tdT1.innerHTML = '<strong>×¡×”×´×›</strong>';
            tdT2.innerHTML = '<strong>' + exp.score + '</strong>';
            trTotal.appendChild(tdT1);
            trTotal.appendChild(tdT2);
            tbody.appendChild(trTotal);
        }

        document.getElementById('exp-prev').addEventListener('click', function () {
            currentIndex = (currentIndex - 1 + explanations.length) % explanations.length;
            renderExplain();
        });

        document.getElementById('exp-next').addEventListener('click', function () {
            currentIndex = (currentIndex + 1) % explanations.length;
            renderExplain();
        });
    </script>
    {% endif %}

    {% if summary %}
    <!-- ×¡×™×›×•× ×œ×¤×™ ××§×•× ×”×›×©×¨×” -->
    <section class="card">
        <h2>ğŸ“ ×˜×‘×œ×ª ×¡×™×›×•× ×œ×¤×™ ××§×•× ×”×ª××—×•×ª</h2>
        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th>×©× ××§×•× ×”×”×ª××—×•×ª</th>
                    <th>×ª×—×•× ×”×”×ª××—×•×ª ×‘××•×¡×“</th>
                    <th>×©× ×”××“×¨×™×š</th>
                    <th>×›××” ×¡×˜×•×“× ×˜×™×</th>
                    <th>×”××œ×¦×ª ×©×™×‘×•×¥</th>
                </tr>
                </thead>
                <tbody>
                {% for row in summary %}
                    <tr>
                        <td>{{ row["×©× ××§×•× ×”×”×ª××—×•×ª"] }}</td>
                        <td>{{ row["×ª×—×•× ×”×”×ª××—×•×ª ×‘××•×¡×“"] }}</td>
                        <td>{{ row["×©× ×”××“×¨×™×š"] }}</td>
                        <td>{{ row["×›××” ×¡×˜×•×“× ×˜×™×"] }}</td>
                        <td>{{ row["×”××œ×¦×ª ×©×™×‘×•×¥"] }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}

    {% if capacities %}
    <!-- ×§×™×‘×•×œ×ª ××•×¡×“×•×ª -->
    <section class="card">
        <h2>ğŸ“Š ×§×™×‘×•×œ×ª ××•×¡×“×•×ª ×•×©×™×‘×•×¥ ×‘×¤×•×¢×œ</h2>
        <div class="table-wrap small">
            <table>
                <thead>
                <tr>
                    <th>×©× ××§×•× ×”×”×ª××—×•×ª</th>
                    <th>×§×™×‘×•×œ×ª</th>
                    <th>×©×•×‘×¦×• ×‘×¤×•×¢×œ</th>
                    <th>×™×ª×¨×”/×—×•×¡×¨</th>
                </tr>
                </thead>
                <tbody>
                {% for row in capacities %}
                    <tr>
                        <td>{{ row["×©× ××§×•× ×”×”×ª××—×•×ª"] }}</td>
                        <td>{{ row["×§×™×‘×•×œ×ª"] }}</td>
                        <td>{{ row["×©×•×‘×¦×• ×‘×¤×•×¢×œ"] }}</td>
                        <td class="{% if row['×™×ª×¨×”/×—×•×¡×¨'] < 0 %}bad{% elif row['×™×ª×¨×”/×—×•×¡×¨'] > 0 %}good{% endif %}">
                            {{ row["×™×ª×¨×”/×—×•×¡×¨"] }}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}

    <!-- ×“×•×’××” ×œ×©×™××•×© -->
    <section class="card">
        <h2>ğŸ§ª ×“×•×’××” ×œ×©×™××•×©</h2>
        <div class="examples">
            <div>
                <h3>×¡×˜×•×“× ×˜×™× â€“ ×“×•×’××”</h3>
                <div class="table-wrap small">
                    <table>
                        <thead>
                        <tr>
                            <th>×©× ×¤×¨×˜×™</th>
                            <th>×©× ××©×¤×—×”</th>
                            <th>×¢×™×¨</th>
                            <th>×ª×—×•× ××•×¢×“×£</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>× ×•×¢×”</td>
                            <td>×›×”×Ÿ</td>
                            <td>×¦×¤×ª</td>
                            <td>×¨×•×•×—×”</td>
                        </tr>
                        <tr>
                            <td>×™××™×¨</td>
                            <td>×œ×•×™</td>
                            <td>× ×”×¨×™×”</td>
                            <td>×‘×¨×™××•×ª ×”× ×¤×©</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div>
                <h3>××ª×¨×™ ×”×ª××—×•×ª â€“ ×“×•×’××”</h3>
                <div class="table-wrap small">
                    <table>
                        <thead>
                        <tr>
                            <th>×©× ××•×¡×“</th>
                            <th>×¢×™×¨</th>
                            <th>×ª×—×•×</th>
                            <th>×§×™×‘×•×œ×ª</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>××—×œ×§×ª ×¨×•×•×—×” ×¦×¤×ª</td>
                            <td>×¦×¤×ª</td>
                            <td>×¨×•×•×—×”</td>
                            <td>3</td>
                        </tr>
                        <tr>
                            <td>××¨×¤××ª ×‘×¨×™××•×ª ×”× ×¤×© × ×”×¨×™×”</td>
                            <td>× ×”×¨×™×”</td>
                            <td>×‘×¨×™××•×ª ×”× ×¤×©</td>
                            <td>2</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

</div>
</body>
</html>
